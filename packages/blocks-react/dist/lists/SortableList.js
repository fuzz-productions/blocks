"use strict";var _createClass=function(){function a(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,r,t){return r&&a(e.prototype,r),t&&a(e,t),e}}();function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}var React=require("react"),PropTypes=require("prop-types");function isBefore(e,r){if(e.parentNode==r.parentNode)for(var t=e;t;t=t.previousSibling)if(t===r)return!0;return!1}function addOrRemoveClass(e,r,t){t?e.className.indexOf(r)<0&&(e.className+=" "+r):e.className=e.className.replace(" "+r,"")}var SortableList=function(){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.listDOM=React.createRef(),r.source=null,r.onDragStart=r.onDragStart.bind(r),r.onDragOver=r.onDragOver.bind(r),r.onDragLeave=r.onDragLeave.bind(r),r.onDragEnd=r.onDragEnd.bind(r),r.onDrop=r.onDrop.bind(r),r}return _inherits(t,React.Component),_createClass(t,[{key:"componentDidMount",value:function(){this.listDOM.current&&(this.listDOM.current.addEventListener("dragstart",this.onDragStart),this.listDOM.current.addEventListener("dragover",this.onDragOver),this.listDOM.current.addEventListener("dragend",this.onDragEnd))}},{key:"isInList",value:function(e){for(var r=e;r;){if(r===this.listDOM.current)return!0;r=r.parentNode}return!1}},{key:"getListElement",value:function(e){if(!this.isInList(e))return null;for(var r=e;r&&"LI"!==r.tagName;)r=r.parentNode;return r}},{key:"getDragTarget",value:function(e){if(!this.isInList(e.target))return null;var r=this.getListElement(e.target);return r===this.source?null:r}},{key:"onDragOver",value:function(e){if(this.source){e.preventDefault();var r=this.getDragTarget(e);r&&(isBefore(this.source,r)?addOrRemoveClass(r,"blx-dragover-top",!0):addOrRemoveClass(r,"blx-dragover-bottom",!0))}}},{key:"onDragLeave",value:function(e){if(this.source){var r=this.getDragTarget(e);r&&(addOrRemoveClass(r,"blx-dragover-top",!1),addOrRemoveClass(r,"blx-dragover-bottom",!1))}}},{key:"onDrop",value:function(e){if(this.source){e.preventDefault();var r=this.getDragTarget(e);if(r){var t=Array.prototype.slice.call(this.listDOM.current.children),a=t.indexOf(this.source);isBefore(this.source,r)?r.parentNode.insertBefore(this.source,r):r.parentNode.insertBefore(this.source,r.nextSibling),addOrRemoveClass(r,"blx-dragover-top",!1),addOrRemoveClass(r,"blx-dragover-bottom",!1),addOrRemoveClass(this.source,"blx-dragging",!1);var n=(t=Array.prototype.slice.call(this.listDOM.current.children)).indexOf(this.source);this.props.onDrop(a,n),this.source=null}}}},{key:"onDragStart",value:function(e){0<=e.target.className.indexOf("blx-icon-drag")&&(this.source=e.target.parentNode,this.source.draggable=!0,addOrRemoveClass(this.source,"blx-dragging",!0),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.source),e.dataTransfer.setDragImage(this.source,275,0))}},{key:"onDragEnd",value:function(e){this.source&&(addOrRemoveClass(this.source,"blx-dragging",!1),this.source=null)}},{key:"render",value:function(){var r=this;return React.createElement("ul",{style:this.props.style,className:"blx-sortable-list "+this.props.className,ref:this.listDOM},React.Children.map(this.props.children,function(e){return React.createElement("li",{key:Math.random(),className:"blx-sortable-list-item",onDragLeave:r.onDragLeave,onDrop:r.onDrop},e,React.createElement("span",{className:"blx-icon blx-icon-drag",draggable:"true"}))}))}}]),t}();SortableList.propTypes={className:PropTypes.string,style:PropTypes.object,onDrop:PropTypes.func},SortableList.defaultProps={className:"",style:null,onDrop:function(){}},module.exports=SortableList;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpc3RzL1NvcnRhYmxlTGlzdC5qc3giXSwibmFtZXMiOlsiUmVhY3QiLCJyZXF1aXJlIiwiUHJvcFR5cGVzIiwiaXNCZWZvcmUiLCJhIiwiYiIsInBhcmVudE5vZGUiLCJjdXIiLCJwcmV2aW91c1NpYmxpbmciLCJhZGRPclJlbW92ZUNsYXNzIiwiZWxlbWVudCIsImNsYXNzTmFtZSIsImFkZCIsImluZGV4T2YiLCJyZXBsYWNlIiwiU29ydGFibGVMaXN0IiwicHJvcHMiLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwiX3RoaXMiLCJfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiIsIl9fcHJvdG9fXyIsIk9iamVjdCIsImdldFByb3RvdHlwZU9mIiwiY2FsbCIsImxpc3RET00iLCJjcmVhdGVSZWYiLCJzb3VyY2UiLCJvbkRyYWdTdGFydCIsImJpbmQiLCJvbkRyYWdPdmVyIiwib25EcmFnTGVhdmUiLCJvbkRyYWdFbmQiLCJvbkRyb3AiLCJDb21wb25lbnQiLCJjdXJyZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsIm5vZGUiLCJjaGlsZCIsImlzSW5MaXN0IiwidGFnTmFtZSIsImUiLCJ0YXJnZXQiLCJsaXN0SXRlbSIsImdldExpc3RFbGVtZW50IiwicHJldmVudERlZmF1bHQiLCJnZXREcmFnVGFyZ2V0IiwibGlzdENoaWxkcmVuIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJzbGljZSIsImNoaWxkcmVuIiwic291cmNlU3RhcnRJbmRleCIsImluc2VydEJlZm9yZSIsIm5leHRTaWJsaW5nIiwic291cmNlRW5kSW5kZXgiLCJkcmFnZ2FibGUiLCJkYXRhVHJhbnNmZXIiLCJlZmZlY3RBbGxvd2VkIiwic2V0RGF0YSIsInNldERyYWdJbWFnZSIsIl90aGlzMiIsImNyZWF0ZUVsZW1lbnQiLCJzdHlsZSIsInJlZiIsIkNoaWxkcmVuIiwibWFwIiwia2V5IiwiTWF0aCIsInJhbmRvbSIsInByb3BUeXBlcyIsInN0cmluZyIsIm9iamVjdCIsImZ1bmMiLCJkZWZh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QSxPQUFBLENBQ0VuRCxVQUFVLHlCQUNWNkMsVUFBVSxzQkFVMUJ6QyxhQUFhdUQsVUFBWSxDQUN2QjNELFVBQVdULFVBQVVxRSxPQUNyQlIsTUFBTzdELFVBQVVzRSxPQUNqQnZDLE9BQVEvQixVQUFVdUUsTUFHcEIxRCxhQUFhMkQsYUFBZSxDQUMxQi9ELFVBQVcsR0FDWG9ELE1BQU8sS0FDUDlCLE9BQVEsY0FHVjBDLE9BQU9DLFFBQVU3RCIsImZpbGUiOiJsaXN0cy9Tb3J0YWJsZUxpc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5jb25zdCBQcm9wVHlwZXMgPSByZXF1aXJlKCdwcm9wLXR5cGVzJyk7XG5cbmZ1bmN0aW9uIGlzQmVmb3JlKGEsIGIpIHtcbiAgaWYgKGEucGFyZW50Tm9kZSA9PSBiLnBhcmVudE5vZGUpIHtcbiAgICBmb3IgKGxldCBjdXIgPSBhOyBjdXI7IGN1ciA9IGN1ci5wcmV2aW91c1NpYmxpbmcpIHtcbiAgICAgIGlmIChjdXIgPT09IGIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gYWRkT3JSZW1vdmVDbGFzcyhlbGVtZW50LCBjbGFzc05hbWUsIGFkZCkge1xuICBpZiAoYWRkKSB7XG4gICAgaWYgKGVsZW1lbnQuY2xhc3NOYW1lLmluZGV4T2YoY2xhc3NOYW1lKSA8IDApIGVsZW1lbnQuY2xhc3NOYW1lICs9IGAgJHtjbGFzc05hbWV9YDtcbiAgfSBlbHNlIHtcbiAgICBlbGVtZW50LmNsYXNzTmFtZSA9IGVsZW1lbnQuY2xhc3NOYW1lLnJlcGxhY2UoYCAke2NsYXNzTmFtZX1gLCAnJyk7XG4gIH1cbn1cblxuY2xhc3MgU29ydGFibGVMaXN0IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICB0aGlzLmxpc3RET00gPSBSZWFjdC5jcmVhdGVSZWYoKTtcbiAgICB0aGlzLnNvdXJjZSA9IG51bGw7XG5cbiAgICB0aGlzLm9uRHJhZ1N0YXJ0ID0gdGhpcy5vbkRyYWdTdGFydC5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25EcmFnT3ZlciA9IHRoaXMub25EcmFnT3Zlci5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25EcmFnTGVhdmUgPSB0aGlzLm9uRHJhZ0xlYXZlLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbkRyYWdFbmQgPSB0aGlzLm9uRHJhZ0VuZC5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25Ecm9wID0gdGhpcy5vbkRyb3AuYmluZCh0aGlzKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIGlmICh0aGlzLmxpc3RET00uY3VycmVudCkge1xuICAgICAgdGhpcy5saXN0RE9NLmN1cnJlbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgdGhpcy5vbkRyYWdTdGFydCk7XG4gICAgICB0aGlzLmxpc3RET00uY3VycmVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIHRoaXMub25EcmFnT3Zlcik7XG4gICAgICB0aGlzLmxpc3RET00uY3VycmVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW5kJywgdGhpcy5vbkRyYWdFbmQpO1xuICAgIH1cbiAgfVxuXG4gIC8vIGNoZWNrIHdoZXRoZXIgYSBnaXZlbiBET00gZWxlbWVudCBpcyBpbnNpZGUgdGhpcyBzb3J0YWJsZSBsaXN0IGF0IGFueSBkZXB0aFxuICBpc0luTGlzdChlbGVtZW50KSB7XG4gICAgbGV0IG5vZGUgPSBlbGVtZW50O1xuICAgIHdoaWxlIChub2RlKSB7XG4gICAgICBpZiAobm9kZSA9PT0gdGhpcy5saXN0RE9NLmN1cnJlbnQpIHJldHVybiB0cnVlO1xuICAgICAgbm9kZSA9IG5vZGUucGFyZW50Tm9kZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLy8gcmV0dXJuIHRoZSBsaXN0IGVsZW1lbnQgPGxpPiB0aGF0IHRoZSBnaXZlbiBlbGVtZW50IGlzIGEgY2hpbGQgb2ZcbiAgLy8gZm9yIHRoZXNlIGxpc3RzLCB0aGUgYWN0dWFsIGRyYWdnYWJsZSBlbGVtZW50IGlzIHRoZSBpY29uLCBidXRcbiAgLy8gd2Ugd2FudCB0byBpZ25vcmUgdGhlIGljb25zIGFsd2F5cyBhbmQgcHJldGVuZCBsaWtlIHRoZSBsaXN0IGl0ZW1zXG4gIC8vIGFyZSB0aGUgZHJhZ2dhYmxlIGVsZW1lbnRzXG4gIGdldExpc3RFbGVtZW50KGNoaWxkKSB7XG4gICAgaWYgKCF0aGlzLmlzSW5MaXN0KGNoaWxkKSkgcmV0dXJuIG51bGw7XG4gICAgbGV0IG5vZGUgPSBjaGlsZDtcbiAgICB3aGlsZSAobm9kZSAmJiBub2RlLnRhZ05hbWUgIT09ICdMSScpIHtcbiAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG4gICAgfVxuICAgIHJldHVybiBub2RlO1xuICB9XG5cbiAgZ2V0RHJhZ1RhcmdldChlKSB7XG4gICAgaWYgKCF0aGlzLmlzSW5MaXN0KGUudGFyZ2V0KSkgcmV0dXJuIG51bGw7XG4gICAgY29uc3QgbGlzdEl0ZW0gPSB0aGlzLmdldExpc3RFbGVtZW50KGUudGFyZ2V0KTtcbiAgICBpZiAobGlzdEl0ZW0gPT09IHRoaXMuc291cmNlKSByZXR1cm4gbnVsbDtcbiAgICByZXR1cm4gbGlzdEl0ZW07XG4gIH1cblxuICBvbkRyYWdPdmVyKGUpIHtcbiAgICBpZiAoIXRoaXMuc291cmNlKSByZXR1cm47XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuZ2V0RHJhZ1RhcmdldChlKTtcbiAgICBpZiAoIXRhcmdldCkgcmV0dXJuO1xuICAgIGlmIChpc0JlZm9yZSh0aGlzLnNvdXJjZSwgdGFyZ2V0KSkge1xuICAgICAgYWRkT3JSZW1vdmVDbGFzcyh0YXJnZXQsICdibHgtZHJhZ292ZXItdG9wJywgdHJ1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFkZE9yUmVtb3ZlQ2xhc3ModGFyZ2V0LCAnYmx4LWRyYWdvdmVyLWJvdHRvbScsIHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIG9uRHJhZ0xlYXZlKGUpIHtcbiAgICBpZiAoIXRoaXMuc291cmNlKSByZXR1cm47XG4gICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5nZXREcmFnVGFyZ2V0KGUpO1xuICAgIGlmICghdGFyZ2V0KSByZXR1cm47XG4gICAgYWRkT3JSZW1vdmVDbGFzcyh0YXJnZXQsICdibHgtZHJhZ292ZXItdG9wJywgZmFsc2UpO1xuICAgIGFkZE9yUmVtb3ZlQ2xhc3ModGFyZ2V0LCAnYmx4LWRyYWdvdmVyLWJvdHRvbScsIGZhbHNlKTtcbiAgfVxuXG4gIG9uRHJvcChlKSB7XG4gICAgaWYgKCF0aGlzLnNvdXJjZSkgcmV0dXJuO1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCB0YXJnZXQgPSB0aGlzLmdldERyYWdUYXJnZXQoZSk7XG4gICAgaWYgKCF0YXJnZXQpIHJldHVybjtcbiAgICBsZXQgbGlzdENoaWxkcmVuID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcy5saXN0RE9NLmN1cnJlbnQuY2hpbGRyZW4pO1xuICAgIGNvbnN0IHNvdXJjZVN0YXJ0SW5kZXggPSBsaXN0Q2hpbGRyZW4uaW5kZXhPZih0aGlzLnNvdXJjZSk7XG4gICAgaWYgKGlzQmVmb3JlKHRoaXMuc291cmNlLCB0YXJnZXQpKSB7XG4gICAgICB0YXJnZXQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5zb3VyY2UsIHRhcmdldCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhcmdldC5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzLnNvdXJjZSwgdGFyZ2V0Lm5leHRTaWJsaW5nKTtcbiAgICB9XG4gICAgYWRkT3JSZW1vdmVDbGFzcyh0YXJnZXQsICdibHgtZHJhZ292ZXItdG9wJywgZmFsc2UpO1xuICAgIGFkZE9yUmVtb3ZlQ2xhc3ModGFyZ2V0LCAnYmx4LWRyYWdvdmVyLWJvdHRvbScsIGZhbHNlKTtcbiAgICBhZGRPclJlbW92ZUNsYXNzKHRoaXMuc291cmNlLCAnYmx4LWRyYWdnaW5nJywgZmFsc2UpO1xuICAgIGxpc3RDaGlsZHJlbiA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHRoaXMubGlzdERPTS5jdXJyZW50LmNoaWxkcmVuKTtcbiAgICBjb25zdCBzb3VyY2VFbmRJbmRleCA9IGxpc3RDaGlsZHJlbi5pbmRleE9mKHRoaXMuc291cmNlKTtcbiAgICB0aGlzLnByb3BzLm9uRHJvcChzb3VyY2VTdGFydEluZGV4LCBzb3VyY2VFbmRJbmRleCk7XG4gICAgdGhpcy5zb3VyY2UgPSBudWxsO1xuICB9XG5cbiAgb25EcmFnU3RhcnQoZSkge1xuICAgIC8vIHRoZSBldmVudCB0YXJnZXQgd2lsbCBiZSB0aGUgaWNvbiwgYnV0IHdlIHdhbnQgdG8ga2VlcFxuICAgIC8vIHRyYWNrIG9mIHRoZSBsaXN0IGl0ZW0gaXRzZWxmICh0aGUgcGFyZW50IG5vZGUpXG4gICAgaWYgKGUudGFyZ2V0LmNsYXNzTmFtZS5pbmRleE9mKCdibHgtaWNvbi1kcmFnJykgPj0gMCkge1xuICAgICAgdGhpcy5zb3VyY2UgPSBlLnRhcmdldC5wYXJlbnROb2RlO1xuICAgICAgdGhpcy5zb3VyY2UuZHJhZ2dhYmxlID0gdHJ1ZTtcbiAgICAgIGFkZE9yUmVtb3ZlQ2xhc3ModGhpcy5zb3VyY2UsICdibHgtZHJhZ2dpbmcnLCB0cnVlKTtcbiAgICAgIGUuZGF0YVRyYW5zZmVyLmVmZmVjdEFsbG93ZWQgPSAnbW92ZSc7XG4gICAgICBlLmRhdGFUcmFuc2Zlci5zZXREYXRhKCd0ZXh0L2h0bWwnLCB0aGlzLnNvdXJjZSk7XG4gICAgICBlLmRhdGFUcmFuc2Zlci5zZXREcmFnSW1hZ2UodGhpcy5zb3VyY2UsIDI3NSwgMCk7XG4gICAgfVxuICB9XG5cbiAgb25EcmFnRW5kKGUpIHtcbiAgICBpZiAoIXRoaXMuc291cmNlKSByZXR1cm47XG4gICAgYWRkT3JSZW1vdmVDbGFzcyh0aGlzLnNvdXJjZSwgJ2JseC1kcmFnZ2luZycsIGZhbHNlKTtcbiAgICB0aGlzLnNvdXJjZSA9IG51bGw7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDx1bFxuICAgICAgICBzdHlsZT17dGhpcy5wcm9wcy5zdHlsZX1cbiAgICAgICAgY2xhc3NOYW1lPXtgYmx4LXNvcnRhYmxlLWxpc3QgJHt0aGlzLnByb3BzLmNsYXNzTmFtZX1gfVxuICAgICAgICByZWY9e3RoaXMubGlzdERPTX1cbiAgICAgID5cbiAgICAgICAge1xuICAgICAgICAgIFJlYWN0LkNoaWxkcmVuLm1hcCh0aGlzLnByb3BzLmNoaWxkcmVuLCBjaGlsZCA9PiAoXG4gICAgICAgICAgICA8bGlcbiAgICAgICAgICAgICAga2V5PXtNYXRoLnJhbmRvbSgpfVxuICAgICAgICAgICAgICBjbGFzc05hbWU9XCJibHgtc29ydGFibGUtbGlzdC1pdGVtXCJcbiAgICAgICAgICAgICAgb25EcmFnTGVhdmU9e3RoaXMub25EcmFnTGVhdmV9XG4gICAgICAgICAgICAgIG9uRHJvcD17dGhpcy5vbkRyb3B9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHtjaGlsZH1cbiAgICAgICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJibHgtaWNvbiBibHgtaWNvbi1kcmFnXCJcbiAgICAgICAgICAgICAgICBkcmFnZ2FibGU9XCJ0cnVlXCJcbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvbGk+XG4gICAgICAgICAgKSlcbiAgICAgICAgfVxuICAgICAgPC91bD5cbiAgICApO1xuICB9XG59XG5cblNvcnRhYmxlTGlzdC5wcm9wVHlwZXMgPSB7XG4gIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgc3R5bGU6IFByb3BUeXBlcy5vYmplY3QsXG4gIG9uRHJvcDogUHJvcFR5cGVzLmZ1bmNcbn07XG5cblNvcnRhYmxlTGlzdC5kZWZhdWx0UHJvcHMgPSB7XG4gIGNsYXNzTmFtZTogJycsXG4gIHN0eWxlOiBudWxsLFxuICBvbkRyb3A6ICgpID0+IHt9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNvcnRhYmxlTGlzdDtcbiJdfQ==
